<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Tic Tac Toe - Neon Edition</title>
 <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
  
  :root {
   --bg-color: #050505;
   --card-bg: #0f0f13;
   --primary-neon: #00f2ff;
   --secondary-neon: #ff0055;
   --accent-neon: #bc00ff;
   --text-main: #e0e0e0;
   --border-glow: 0 0 10px rgba(0, 242, 255, 0.5);
  }
  
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
   font-family: 'Poppins', sans-serif;
   background-color: var(--bg-color);
   background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #050505 100%);
   color: var(--text-main);
   display: flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   min-height: 100vh;
   margin: 0;
   overflow: hidden;
  }
  
  h1, h2, h3 { margin: 0 0 1rem 0; text-shadow: 0 0 10px var(--primary-neon); text-align: center; }
  h1 { font-size: 2.2rem; color: var(--primary-neon); }
  
  .screen {
   position: fixed;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
   background: rgba(5, 5, 5, 0.98);
   display: flex;
   flex-direction: column;
   justify-content: center;
   align-items: center;
   z-index: 100;
   padding: 20px;
   transition: opacity 0.3s ease;
  }
  
  .hidden { display: none !important; }
  
  .card {
   background: var(--card-bg);
   border: 2px solid var(--primary-neon);
   padding: 30px;
   border-radius: 12px;
   box-shadow: var(--border-glow);
   width: 100%;
   max-width: 360px;
   text-align: center;
  }
  
  .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
  
  button {
   font-family: 'Poppins', sans-serif;
   font-weight: 600;
   padding: 14px;
   border: 1px solid var(--primary-neon);
   background: transparent;
   color: var(--primary-neon);
   cursor: pointer;
   transition: all 0.2s;
   border-radius: 8px;
   font-size: 1rem;
  }
  
  button:hover { background: rgba(0, 242, 255, 0.1); box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }
  
  .game-board {
   display: grid;
   grid-template-columns: repeat(3, 1fr);
   gap: 10px;
   width: 320px;
   height: 320px;
   margin: 20px auto;
  }
  
  .cell {
   background: rgba(255, 255, 255, 0.05);
   border: 1px solid rgba(0, 242, 255, 0.2);
   display: flex;
   align-items: center;
   justify-content: center;
   font-size: 2.5rem;
   font-weight: 700;
   cursor: pointer;
   border-radius: 8px;
   transition: all 0.2s;
  }
  
  .cell:hover { background: rgba(0, 242, 255, 0.1); border-color: var(--primary-neon); }
  .cell.x-color { color: var(--primary-neon); text-shadow: 0 0 10px var(--primary-neon); }
  .cell.o-color { color: var(--secondary-neon); text-shadow: 0 0 10px var(--secondary-neon); }
  
  .cell.winning-cell {
   background: var(--accent-neon);
   color: white;
   box-shadow: 0 0 25px var(--accent-neon);
   animation: pulse 1s infinite alternate;
  }

  @keyframes pulse {
   from { transform: scale(1); }
   to { transform: scale(1.05); }
  }
  
  .scoreboard {
   display: grid;
   grid-template-columns: 1fr 1fr 1fr;
   width: 320px;
   gap: 10px;
   margin-bottom: 15px;
  }
  
  .score-box {
   background: #111;
   border: 1px solid #333;
   padding: 8px;
   text-align: center;
   border-radius: 8px;
   font-size: 0.8rem;
  }
  
  .status-bar {
   width: 320px;
   background: var(--primary-neon);
   color: var(--bg-color);
   padding: 8px;
   font-weight: 700;
   text-align: center;
   border-radius: 4px;
   margin-bottom: 15px;
   min-height: 40px;
  }
  
  .footer-btns { display: flex; gap: 10px; width: 320px; }
  .footer-btns button { flex: 1; padding: 10px; font-size: 0.8rem; }
  .label-tag { color: var(--secondary-neon); font-size: 0.8rem; margin-bottom: 5px; font-weight: 600; }
 </style>
 
 <!-- Vercel Web Analytics -->
 <script>
   window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
 </script>
 <script defer src="/_vercel/insights/script.js"></script>
</head>

<body>
 <div id="mode-screen" class="screen">
  <div class="card">
   <h1>Tic Tac Toe</h1>
   <div class="btn-group">
    <button onclick="setMode('ai')">Play vs Computer</button>
    <button onclick="setMode('pvp')">Play vs Friend</button>
   </div>
   <p style="margin-top: 20px; font-size: 0.9rem;">AI Defeated: <span id="global-ai-wins">0</span> times</p>
  </div>
 </div>
 
 <div id="difficulty-screen" class="screen hidden">
  <div class="card">
   <h3>Choose Difficulty</h3>
   <div class="btn-group">
    <button onclick="setDifficulty(1)">Level 1: Novice</button>
    <button onclick="setDifficulty(2)">Level 2: Easy</button>
    <button onclick="setDifficulty(3)">Level 3: Medium</button>
    <button onclick="setDifficulty(4)">Level 4: Hard</button>
    <button style="border-color: var(--secondary-neon); color: var(--secondary-neon);" onclick="setDifficulty(5)">Level 5: Impossible</button>
   </div>
   <button style="margin-top: 15px; border: none; color: #888;" onclick="showScreen('mode-screen')">Back</button>
  </div>
 </div>
 
 <div id="shape-screen" class="screen hidden">
  <div class="card">
   <h3 id="shape-title">Pick Your Shape</h3>
   <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
    <button style="font-size: 2rem; width: 80px; height: 80px;" onclick="setShape('X')">X</button>
    <button style="font-size: 2rem; width: 80px; height: 80px;" onclick="setShape('O')">O</button>
   </div>
   <button style="margin-top: 15px; border: none; color: #888;" onclick="goBackFromShape()">Back</button>
  </div>
 </div>
 
 <div id="game-screen" class="screen hidden">
  <div class="label-tag" id="game-info">Mode: Computer</div>
  
  <div class="scoreboard">
   <div class="score-box">
    <div id="p1-name">Player 1</div>
    <div id="p1-score">0</div>
   </div>
   <div class="score-box">Draws<div id="draw-score">0</div></div>
   <div class="score-box">
    <div id="p2-name">Computer</div>
    <div id="p2-score">0</div>
   </div>
  </div>
  
  <div class="status-bar" id="status-text">Your Turn</div>
  
  <div class="game-board" id="board">
   <div class="cell" data-index="0"></div>
   <div class="cell" data-index="1"></div>
   <div class="cell" data-index="2"></div>
   <div class="cell" data-index="3"></div>
   <div class="cell" data-index="4"></div>
   <div class="cell" data-index="5"></div>
   <div class="cell" data-index="6"></div>
   <div class="cell" data-index="7"></div>
   <div class="cell" data-index="8"></div>
  </div>
  
  <div class="footer-btns">
   <button onclick="resetGame()">Reset Board</button>
   <button onclick="showScreen('mode-screen')">Main Menu</button>
  </div>
 </div>
 
 <script>
let gameMode = 'ai'; 
let difficulty = 1; 
let player1Shape = 'X'; 
let player2Shape = 'O';
let currentPlayer = 'X'; 
let board = ['', '', '', '', '', '', '', '', ''];
let gameActive = false;

// Score tracking object
const scores = {
 ai: { p1: 0, ai: 0, draws: 0 },
 pvp: { p1: 0, p2: 0, draws: 0 }
};

let globalAiWins = parseInt(localStorage.getItem('ttt_neon_wins')) || 0;

const screens = ['mode-screen', 'difficulty-screen', 'shape-screen', 'game-screen'];
const cells = document.querySelectorAll('.cell');
const statusText = document.getElementById('status-text');

function init() {
 document.getElementById('global-ai-wins').innerText = globalAiWins;
 cells.forEach(c => c.addEventListener('click', handleCellClick));
}

function showScreen(id) {
 screens.forEach(s => document.getElementById(s).classList.toggle('hidden', s !== id));
}

function setMode(mode) {
 gameMode = mode;
 if (mode === 'ai') {
  showScreen('difficulty-screen');
 } else {
  document.getElementById('shape-title').innerText = "Player 1: Choose Shape";
  showScreen('shape-screen');
 }
}

function setDifficulty(lvl) {
 difficulty = lvl;
 document.getElementById('shape-title').innerText = "Pick Your Shape";
 showScreen('shape-screen');
}

function goBackFromShape() {
 if (gameMode === 'ai') showScreen('difficulty-screen'); 
 else showScreen('mode-screen');
}

function setShape(shape) {
 player1Shape = shape;
 player2Shape = shape === 'X' ? 'O' : 'X';
 startNewGame();
}

function startNewGame() {
 board = ['', '', '', '', '', '', '', '', ''];
 gameActive = true;
 currentPlayer = 'X';
 
 document.getElementById('game-info').innerText = gameMode === 'ai' ? `Difficulty: Level ${difficulty}` : "Mode: vs Friend";
 document.getElementById('p1-name').innerText = gameMode === 'ai' ? `You (${player1Shape})` : `P1 (${player1Shape})`;
 document.getElementById('p2-name').innerText = gameMode === 'ai' ? `AI (${player2Shape})` : `P2 (${player2Shape})`;
 
 updateScoreboard();
 renderBoard();
 updateStatus();
 showScreen('game-screen');
 
 // If AI is X, it goes first
 if (gameActive && gameMode === 'ai' && player2Shape === 'X') {
  setTimeout(makeAiMove, 600);
 }
}

function handleCellClick(e) {
 const index = e.target.dataset.index;
 if (board[index] !== '' || !gameActive) return;
 
 // Block clicking if it's the AI's turn
 if (gameMode === 'ai' && currentPlayer === player2Shape) return;

 makeMove(index);
}

function makeMove(index) {
 board[index] = currentPlayer;
 renderBoard();
 
 const winResult = checkWin(board);
 
 if (winResult) {
  endGame(winResult);
 } else if (board.every(c => c !== '')) {
  endGame('draw');
 } else {
  currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
  updateStatus();
  
  // Trigger AI if necessary
  if (gameActive && gameMode === 'ai' && currentPlayer === player2Shape) {
   setTimeout(makeAiMove, 600);
  }
 }
}

function renderBoard() {
 cells.forEach((cell, i) => {
  cell.innerText = board[i];
  cell.className = 'cell';
  if (board[i] === 'X') cell.classList.add('x-color');
  if (board[i] === 'O') cell.classList.add('o-color');
 });
}

function updateStatus() {
 if (!gameActive) return;
 if (gameMode === 'pvp') {
  const pName = currentPlayer === player1Shape ? '1' : '2';
  statusText.innerText = `Turn: Player ${pName} (${currentPlayer})`;
 } else {
  statusText.innerText = currentPlayer === player1Shape ? "Your Turn" : "AI is thinking...";
 }
}

function checkWin(b) {
 const winPatterns = [
  [0,1,2], [3,4,5], [6,7,8], // Rows
  [0,3,6], [1,4,7], [2,5,8], // Cols
  [0,4,8], [2,4,6]           // Diagonals
 ];
 
 for (let pattern of winPatterns) {
  const [a, b_idx, c] = pattern;
  if (b[a] && b[a] === b[b_idx] && b[a] === b[c]) {
   return { winner: b[a], pattern };
  }
 }
 return null;
}

function endGame(res) {
 gameActive = false;
 if (res === 'draw') {
  statusText.innerText = 'Game is a Draw!';
  if (gameMode === 'ai') scores.ai.draws++; else scores.pvp.draws++;
 } else {
  const isP1 = res.winner === player1Shape;
  statusText.innerText = isP1 ? "Player 1 Wins!" : (gameMode === 'ai' ? "Computer Wins!" : "Player 2 Wins!");
  
  // Highlight winning cells
  res.pattern.forEach(i => cells[i].classList.add('winning-cell'));
  
  if (gameMode === 'ai') {
   if (isP1) {
    scores.ai.p1++;
    globalAiWins++;
    localStorage.setItem('ttt_neon_wins', globalAiWins);
    document.getElementById('global-ai-wins').innerText = globalAiWins;
   } else {
    scores.ai.ai++;
   }
  } else {
   isP1 ? scores.pvp.p1++ : scores.pvp.p2++;
  }
 }
 updateScoreboard();
}

function updateScoreboard() {
 const s = gameMode === 'ai' ? scores.ai : scores.pvp;
 document.getElementById('p1-score').innerText = s.p1;
 document.getElementById('draw-score').innerText = s.draws;
 document.getElementById('p2-score').innerText = (gameMode === 'ai' ? s.ai : s.p2);
}

function resetGame() {
 startNewGame();
}

// AI LOGIC 
function makeAiMove() {
 if (!gameActive) return;
 
 // Difficulty logic: Chance to make a perfect move vs random move
 const smartChance = [0, 0.1, 0.4, 0.7, 0.9, 1.0][difficulty];
 let moveIndex;
 
 if (Math.random() < smartChance) {
  moveIndex = minimax(board, player2Shape).index;
 } else {
  const avail = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  moveIndex = avail[Math.floor(Math.random() * avail.length)];
 }
 
 if (moveIndex !== undefined) makeMove(moveIndex);
}

function minimax(newBoard, player) {
 const availSpots = newBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
 
 const win = checkWin(newBoard);
 if (win && win.winner === player1Shape) return { score: -10 };
 if (win && win.winner === player2Shape) return { score: 10 };
 if (availSpots.length === 0) return { score: 0 };
 
 const moves = [];
 for (let i = 0; i < availSpots.length; i++) {
  const move = {};
  move.index = availSpots[i];
  newBoard[availSpots[i]] = player;
  
  if (player === player2Shape) {
   const result = minimax(newBoard, player1Shape);
   move.score = result.score;
  } else {
   const result = minimax(newBoard, player2Shape);
   move.score = result.score;
  }
  
  newBoard[availSpots[i]] = ''; // Backtrack
  moves.push(move);
 }
 
 let bestMove;
 if (player === player2Shape) {
  let bestScore = -10000;
  for (let i = 0; i < moves.length; i++) {
   if (moves[i].score > bestScore) {
    bestScore = moves[i].score;
    bestMove = i;
   }
  }
 } else {
  let bestScore = 10000;
  for (let i = 0; i < moves.length; i++) {
   if (moves[i].score < bestScore) {
    bestScore = moves[i].score;
    bestMove = i;
   }
  }
 }
 return moves[bestMove];
}

init();
 </script>
</body>
</html>
